version: '3.2'
services:

  portainer:
    image: portainer/portainer:linux-arm
    container_name: portainer
    command: ["--host=unix:///var/run/docker.sock", "--no-auth"]
    restart: always
    network_mode: host
    volumes:
      # docker socket
      - /var/run/docker.sock:/var/run/docker.sock

  dashboard:
    image: duckietown/dt-duckiebot-dashboard:daffy-arm32v7
    container_name: duckiebot-dashboard
    restart: unless-stopped
    network_mode: host
    volumes:
      - /data:/data
      # compose volume
      - compose-data:/var/www/html
      # avahi socket
      - /var/run/avahi-daemon/socket:/var/run/avahi-daemon/socket
      # dbus socket
      - /var/run/dbus/system_bus_socket:/var/run/dbus/system_bus_socket

  files-api:
    image: duckietown/dt-files-api:daffy-arm32v7
    container_name: files-api
    restart: always
    network_mode: host
    volumes:
      - /data:/data
      # avahi socket
      - /var/run/avahi-daemon/socket:/var/run/avahi-daemon/socket
      # dbus socket
      - /var/run/dbus/system_bus_socket:/var/run/dbus/system_bus_socket

#  device-proxy:
#    image: duckietown/dt-device-proxy:daffy-arm32v7
#    container_name: device-proxy
#    restart: always
#    network_mode: host
#    volumes:
#      - /data:/data
#      # avahi socket
#      - /var/run/avahi-daemon/socket:/var/run/avahi-daemon/socket

  device-health:
    image: duckietown/dt-device-health:daffy-arm32v7
    container_name: device-health
    restart: always
    network_mode: host
    devices:
      - /dev/vchiq:/dev/vchiq
    volumes:
      - /data:/data
      # avahi socket
      - /var/run/avahi-daemon/socket:/var/run/avahi-daemon/socket
      # dbus socket
      - /var/run/dbus/system_bus_socket:/var/run/dbus/system_bus_socket

  device-online:
    image: duckietown/dt-device-online:daffy-arm32v7
    container_name: device-online
    restart: always
    network_mode: host
    volumes:
      - /data:/data
      # avahi socket
      - /var/run/avahi-daemon/socket:/var/run/avahi-daemon/socket
      # dbus socket
      - /var/run/dbus/system_bus_socket:/var/run/dbus/system_bus_socket

  duckiebot-interface:
    image: duckietown/dt-duckiebot-interface:daffy-arm32v7
    container_name: duckiebot-interface
    restart: unless-stopped
    network_mode: host
    privileged: true
    environment:
      DISABLE_CONTRACTS: 1
    volumes:
      - /data:/data
      # avahi socket
      - /var/run/avahi-daemon/socket:/var/run/avahi-daemon/socket
      # dbus socket
      - /var/run/dbus/system_bus_socket:/var/run/dbus/system_bus_socket

  car-interface:
    image: duckietown/dt-car-interface:daffy-arm32v7
    container_name: car-interface
    restart: unless-stopped
    network_mode: host
    privileged: true
    environment:
      DISABLE_CONTRACTS: 1
    volumes:
      - /data:/data
      # avahi socket
      - /var/run/avahi-daemon/socket:/var/run/avahi-daemon/socket
      # dbus socket
      - /var/run/dbus/system_bus_socket:/var/run/dbus/system_bus_socket

  rosbridge-websocket:
    image: duckietown/dt-rosbridge-websocket:daffy-arm32v7
    container_name: rosbridge-websocket
    restart: unless-stopped
    network_mode: host
    volumes:
      - /data:/data
      # avahi socket
      - /var/run/avahi-daemon/socket:/var/run/avahi-daemon/socket
      # dbus socket
      - /var/run/dbus/system_bus_socket:/var/run/dbus/system_bus_socket

volumes:
  compose-data: